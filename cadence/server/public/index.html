<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8"/>
        <meta name="viewport" content="width=device-width, initial-scale=1.0">

        <title>Cadence Radio ♥</title>

        <meta name="description" content="A Rhythmic Experience">

        <meta property="og:url" content="https://cadenceradio.com">
        <meta property="og:type" content="website">
        <meta property="og:title" content="Cadence Radio ♥">
        
        <meta name="twitter:card" content="summary_large_image">
        <meta property="twitter:domain" content="cadenceradio.com">
        <meta property="twitter:url" content="https://cadenceradio.com">
        <meta name="twitter:title" content="Cadence Radio ♥">

        <link rel="icon" type="image/x-icon" href="/static/favicon.ico">

        <!-- Fonts -->
        <link rel="preconnect" href="https://fonts.googleapis.com">
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link href="https://fonts.googleapis.com/css2?family=Roboto+Condensed:wght@300&display=swap" rel="stylesheet"> 
        <!-- Bulma CSS -->
        <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bulma@0.9.4/css/bulma.min.css">
        <!-- Main CSS -->
        <link rel="stylesheet" href="./css/main.css">

        <!-- jQuery Google CDN -->
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
        <!-- API (Aria) scripts -->
        <script type="text/javascript" src="./js/aria.js"></script>
        <!-- Radio player scripts -->
        <script type="text/javascript" src="./js/page.js"></script>
    </head>
    <body>
        <div id="player" class="columns is-centered is-vcentered box">
            <div class="column is-narrow is-offset-1-desktop is-3-desktop-only">
                <div id="artworkcontainer">
                    <img id="artwork" src=""/>
                </div>
            </div>
            <div class="column" id="playerinfo">
                <audio id="stream" src="" type="audio/mp3"></audio>
                <div id="song">-</div>
                <div id="artist">-</div>
                <div id="playButton">►</div>
                <input type="range" id="volume" value=".3" min="0" max="1" step="0.006" class="block" >
                <div id="status">Disconnected from server.</div>
                <div id="version" class="block">Current Listeners: <span id="listeners">-</span></div>
            </div>
        </div>
        
        <div id="tabs" class="tabs is-centered is-boxed">
            <ul>
                <li data-tab="request" class="is-active"><a>Request</a></li>
                <li data-tab="about"><a>About</a></li>
                <li data-tab="api"><a>API</a></li>
            </ul>
        </div>

        <div id="tab-content">
            <section data-content="request" class="content is-active">
                <input name="searchInput" id="searchInput" class="input is-medium" type="text" placeholder="Filter for a song or artist!">
                <div id="requestStatus"></div>
                <div id="searchResults"></div>
            </section>
            <section data-content="about" class="content">
                <p>Read a complete <a href="https://kenellorando.notion.site/Cadence-All-in-One-Web-Radio-Software-Suite-d1f0184b5eeb4882a3d6f78d582b2de6">blog post on Cadence's design</a>.</p>
                <hr/>
                <p><b>Cadence</b> is an all-in-one web radio suite, allowing anyone to quickly and easily start an internet radio website in minutes.</p>
                <p>The project ships with <i>Icecast</i> and <i>Liquidsoap</i> working out-of-the-box, complemented by a UI, music search, song request, artwork, and real-time stream information features. An auto-populating metadata database tracks your radio music library for you.</p>
                <p>The project ships all components mostly pre-configured to work with each each other so there is hardly any configuration to do. To start your own instance of Cadence, provide a music directory path, set a few service passwords and hostnames, and you're good to go! Cadence ships with a Docker Compose file that will set the entire radio stack up in a single command. Cadence is open source and available for free on <a href="https://github.com/kenellorando/cadence">GitHub</a>.</p>
            </section>
            <section data-content="api" class="content">
                <p>All requests, responses, and messages shall be transmitted as raw JSON.</p>

                <h2 class="title is-3"><span class="tag is-info block">POST</span> <code>/api/search</code></h2>
                <p>Search the server's music library.</p>
                <p>Cadence's API searches by "title" and "artist" metadata. This API call returns a list of results ordered by relevance.</p>
                <h3 class="title is-6">Request</h3>
                <code>{ "search": "railgun" }</code>
                <h3 class="title is-6">Response</h3>
                <ul>
                    <li>200 OK <code>[ { "ID": "1", "Artist": "fripSide", "Title": "only my railgun", "Album": "only my railgun - Single", "Genre": "J-Pop", "Year": 2009}, ...]</code>
                    </li>
                    <li>400 Bad Request</li>
                </ul>

                <hr/>

                <h2 class="title is-3"><span class="tag is-info block">POST</span>  <code>/api/request/id</code></h2>
                <p>Submit a request for a specific song to be played.</p>
                <p>Accepts a song ID, which is an arbitrary label Cadence internally uses to track songs and is not an inherent attribute of the audio file itself. You should execute a search for an ID as a prerequisite to request if you want a guaranteed request match. Alternatively, consider using <code>/api/request/bestmatch</code> to automatically request the number one search result immediately.</p>
                <h3 class="title is-6">Request</h3>
                <code>{ "ID": "1" }</code>

                <h3 class="title is-6">Response</h3>
                <ul>
                    <li>202 Accepted</li>
                    <li>400 Bad Request</li>
                    <li>429 Too Many Requests - Indicates you have made too many song requests within the timeframe configured for Cadence's request rate limiter.</li>
                </ul>

                <hr/>

                <h2 class="title is-3"><span class="tag is-info block">POST</span> <code>/api/request/bestmatch</code></h2>
                <p>Executes a search, selects the number one result (the most relevant result to the search), and submits a request for it.</p>
                <p>This is Cadence's equivalent to Google's "I'm Feeling Lucky".</p>
                <h3 class="title is-6">Request</h3>
                <code>{ "Search": "only my railgun fripSide" }</code>
                <h3 class="title is-6">Response</h3>
                <ul>
                    <li>202 Accepted</li>
                    <li>400 Bad Request</li>
                    <li>429 Too Many Requests - This indicates you have made too many song requests within the timeframe configured for Cadence's request rate limiter.</li>
                </ul>

                <hr/>

                <h2 class="title is-3"><span class="tag is-success block">GET</span> <code>/api/nowplaying/metadata</code></h2>
                <p>Gets all text metadata on the currently playing song.</p>
                <p>If there are multiple audio files on the server which share the exact same title and artist, Cadence will return the first result only.</p>
                <p>This does not return album art. To fetch album art, use <code>/api/nowplaying/albumart</code></p>
                <h3 class="title is-6">Response</h3>
                <ul>
                    <li>200 OK <code>{ "ID": "1", "Artist": "fripSide", "Title": "only my railgun", "Album": "only my railgun - Single", "Genre": "J-Pop", "Year": 2009}</code>
                    <li>404 Not Found - Indicates the song currently playing is not in Cadence's internal database.</li>
                </ul>

                <hr/>
                
                <h2 class="title is-3"><span class="tag is-success block">GET</span> <code>/api/nowplaying/albumart</code></h2>
                <p>Gets the base64-encoded album art of the currently playing song.</p>
                <h3 class="title is-6">Response</h3>
                <ul>
                    <li>200 OK <code>{ "Picture": "(base64 encoding of album art)" } </code>
                    <li>404 Not Found - Indicates the song currently playing did not get written to Cadence's internal database or more likely simply does not have any artwork metadata.</li>
                </ul>

                <hr/>

                <h2 class="title is-3"><span class="tag is-success block">GET</span> <code>/api/listeners</code></h2>
                <p>Returns the number of connected listeners.</p>
                <h3 class="title is-6">Response</h3>
                <ul>
                    <li>200 OK <code>{ "Listeners": 14 }</code>
                </ul>

                <hr/>

                <h2 class="title is-3"><span class="tag is-success block">GET</span> <code>/api/listenurl</code></h2>
                <p>Returns the direct audio listen URL. Useful for programmatically setting an audio source.</p>
                <h3 class="title is-6">Response</h3>
                <ul>
                    <li><code>200 OK { "ListenURL": "cadenceradio.com/cadence1" }</code></li>
                </ul>

                <hr/>
                
                <h2 class="title is-3"><span class="tag is-success block">GET</span> <code>/api/version</code></h2>
                <p>Returns the server version.</p>
                <h3 class="title is-6">Response</h3>
                <ul>
                    <li><code>200 OK { "Version": "5.0.3" }</code></li>
                </ul>

                <hr/>

                <h2 class="title is-3"><span class="tag is-success block">GET</span> <code>/ready</code></h2>
                <p>Endpoint for Cadence API health check.</p>
                <h3 class="title is-6">Response</h3>
                <ul>
                    <li><code>200 OK</code></li>
                </ul>

                <h2 class="title is-3"><span class="tag is-success block">GET</span> <code>/api/radiodata/sse</code></h2>
                <p>A special server-sent event API that returns updated stream data in real-time.</p>
                <p>Clients that connect to this endpoint will receive server-pushed data as it changes live on the backend without the need for the client to poll, for as long as the client remains connected.</p>
                <p>Various real-time data is communicated through this API and is differentiated by unique <code>event</code>s. his event source monitors and notifies changes for <code>title</code>, <code>artist</code>, <code>listenurl</code>, and <code>listeners</code>.
                <p>As an example, if the playing song changes, all connected clients receive a <code>"title"</code> and <code>"artist"</code> event from the server. Here is an example of subscribing to the event stream in JavaScript:</p>
<pre>
let eventSource = new EventSource("/api/radiodata/sse");
eventSource.addEventListener("title", function(event) {
    console.log(event.data);    // "only my railgun"
});
eventSource.addEventListener("artist", function(event) {
    console.log(event.data);    // "fripSide"
});
eventSource.addEventListener("listenurl", function(event) {
    console.log(event.data);    // "cadenceradio.com/cadence1"
});
eventSource.addEventListener("listeners", function(event) {
    console.log(event.data);    // 14
});
</pre>
            </section>
        </div>
        <footer>
            <div>Cadence Radio <span id="release">-</span></div>
            <div>
                <a href="https://github.com/kenellorando/cadence">GitHub</a> 
            </div>
        </footer>
    </body>
</html>
